<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Trading Singularity AI Coach</title>
<style>
  :root { --bg:#000; --panel:#0f0f10; --gold:#FFD700; --text:#e9e9e9; }
  body { margin:0; background:var(--bg); color:var(--text); font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto; }
  .wrap { max-width: 880px; margin: 0 auto; height: 100vh; display:flex; flex-direction:column; }
  header { padding:14px 16px; border-bottom:1px solid #1e1e20; display:flex; align-items:center; gap:10px; }
  .logo { width:28px; height:28px; border-radius:6px; background:linear-gradient(135deg, var(--gold), #b49300); }
  .brand { font-weight:700; letter-spacing:0.3px; }
  #chat { flex:1; overflow:auto; padding:16px; }
  .msg { margin:10px 0; padding:12px 14px; border-radius:12px; max-width: 85%; white-space:pre-wrap; }
  .user { background:#1b1b1d; margin-left:auto; border:1px solid #2b2b2e; }
  .bot { background:var(--panel); border:1px solid #232326; }
  .hint { color:#bdbdbd; font-size:13px; margin-top:4px;}
  footer { border-top:1px solid #1e1e20; padding:12px; background:#0b0b0c; }
  .bar { display:flex; gap:10px; }
  textarea { flex:1; resize:none; border:1px solid #262628; background:#121214; color:var(--text); padding:12px; border-radius:10px; height:54px; outline:none; }
  button { background:var(--gold); color:#000; font-weight:700; border:none; border-radius:10px; padding:0 18px; min-width:120px; cursor:pointer; }
  .sub { font-size:12px; opacity:0.85; padding-left:2px; }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo"></div>
      <div>
        <div class="brand">Trading Singularity AI Coach</div>
        <div class="sub">Discipline • Data • Compounding</div>
      </div>
    </header>

    <div id="chat"></div>

    <footer>
      <div class="bar">
        <textarea id="input" placeholder="Ask me to analyze your week, your last 10 trades, or your discipline… (Shift+Enter = newline)"></textarea>
        <button id="send">Send</button>
      </div>
      <div class="hint">Tip: Try “Summarize my past week and give me 3 rules to tighten risk.”</div>
    </footer>
  </div>

<script>
// Replace this with your deployed Vercel URL after Step 1
const ENDPOINT = "https://YOUR-VERCEL-PROJECT.vercel.app/api/chat";

const chat = document.getElementById("chat");
const input = document.getElementById("input");
const sendBtn = document.getElementById("send");

let history = []; // [{role, content}]

function addBubble(text, who="bot") {
  const div = document.createElement("div");
  div.className = `msg ${who === "user" ? "user" : "bot"}`;
  div.textContent = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
  return div;
}

function welcome() {
  addBubble(
`Welcome. I’m your Trading Singularity AI Coach.

I’ll help you:
• Review trades & stats (win rate, R/R, profit factor)
• Spot discipline leaks (revenge trades, size creep, FOMO)
• Set weekly rules & routines
• Improve compounding consistency

Ask me: 
“Analyze my last 10 trades: entries, exits, R/R, and 2 habits to fix.”`);
}
welcome();

async function send() {
  const text = input.value.trim();
  if (!text) return;
  input.value = "";
  addBubble(text, "user");
  history.push({ role: "user", content: text });

  const botDiv = addBubble("…");
  let acc = "";

  try {
    const res = await fetch(ENDPOINT, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        messages: history,
        model: "gpt-4o-mini",
        temperature: 0.4,
        max_tokens: 500
      })
    });

    if (!res.ok || !res.body) {
      botDiv.textContent = "Error: coach temporarily unavailable.";
      return;
    }

    const reader = res.body.getReader();
    const decoder = new TextDecoder("utf-8");
    while (true) {
      const { value, done } = await reader.read();
      if (done) break;
      const chunk = decoder.decode(value, { stream: true });
      const lines = chunk.split("\n");
      for (const line of lines) {
        if (!line.startsWith("data:")) continue;
        const data = line.slice(5).trim();
        if (data === "[DONE]") continue;
        try {
          const json = JSON.parse(data);
          const delta = json.choices?.[0]?.delta?.content ?? "";
          if (delta) {
            acc += delta;
            botDiv.textContent = acc;
            chat.scrollTop = chat.scrollHeight;
          }
        } catch {}
      }
    }
    if (acc) history.push({ role: "assistant", content: acc });
  } catch (e) {
    botDiv.textContent = "Network error. Try again.";
  }
}

sendBtn.addEventListener("click", send);
input.addEventListener("keydown", (e) => {
  if (e.key === "Enter" && !e.shiftKey) {
    e.preventDefault(); send();
  }
});
</script>
</body>
</html>
